<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFL BEANO v4.0 - Reroll Edition</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <!-- Fun, Chunky Font -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Titan+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #ffffff;
            --primary: #333;
            --secondary: #555;
            --accent: #fff;
            --gold: #fbbf24;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: 'Fredoka', sans-serif;
            background-color: #0f172a; /* Fallback */
            background-image: 
                radial-gradient(#ffffff 1px, transparent 1px),
                radial-gradient(#ffffff 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            background-color: #265df2; /* Vibrant Blue Base */
            color: #333;
            overflow-x: hidden;
        }

        /* --- LOBBY --- */
        #lobby {
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            position: fixed; top: 0; left: 0; width: 100%; z-index: 2000;
        }
        .lobby-panel {
            background: white;
            padding: 40px;
            border-radius: 30px;
            width: 90%; max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 0px rgba(0,0,0,0.2);
            border: 5px solid #fff;
        }
        .lobby-panel h1 { font-family: 'Titan One', cursive; font-size: 3rem; margin: 0; color: #265df2; text-transform: uppercase; }
        .lobby-panel h3 { margin-top: 0; color: #888; }
        
        .input-group { margin: 20px 0; text-align: left; }
        .input-group label { display: block; font-weight: 700; color: #555; margin-bottom: 5px; text-transform: uppercase; }
        
        select, input {
            width: 100%; padding: 15px;
            border: 3px solid #eee; border-radius: 12px;
            font-size: 1.1rem; font-family: 'Fredoka', sans-serif; font-weight: 600;
            outline: none;
        }
        select:focus, input:focus { border-color: #265df2; }

        button {
            width: 100%; padding: 15px;
            border: none; border-radius: 15px;
            font-family: 'Titan One', cursive; font-size: 1.5rem; letter-spacing: 1px;
            cursor: pointer; transform: translateY(0); transition: 0.1s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            margin-top: 10px;
        }
        button:active { transform: translateY(6px); box-shadow: none; }
        .btn-host { background: #ff4757; color: white; }
        .btn-join { background: #2ed573; color: white; }

        /* --- GAME LAYOUT --- */
        #game-ui {
            display: flex;
            flex-wrap: wrap;
            min-height: 100vh;
        }

        /* LEFT SIDE: MY HAND */
        .pane-my-hand {
            flex: 1;
            min-width: 350px;
            background: transparent;
            padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            border-right: 5px dashed rgba(255,255,255,0.2);
        }

        /* RIGHT SIDE: THE FIELD */
        .pane-field {
            flex: 1;
            min-width: 350px;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .section-title {
            font-family: 'Titan One', cursive;
            font-size: 2.5rem;
            color: white;
            text-transform: uppercase;
            text-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        /* --- PLAYER CARD CONTAINER (The "Pop Art" Wrapper) --- */
        .player-wrapper {
            background-color: var(--primary); /* Team Color */
            border-radius: 30px;
            padding: 25px;
            width: 100%;
            max-width: 1000px;
            border: 6px solid white;
            box-shadow: 0 15px 0 rgba(0,0,0,0.2);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        /* Confetti Decoration CSS */
        .player-wrapper::before {
            content: "";
            position: absolute; inset: 0;
            background-image: 
                radial-gradient(circle, rgba(255,255,255,0.2) 10%, transparent 11%),
                radial-gradient(circle, rgba(255,255,255,0.2) 10%, transparent 11%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            opacity: 0.6; pointer-events: none;
        }
        /* Squiggles via CSS SVG background */
        .player-wrapper::after {
            content: "";
            position: absolute; inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 5c5 0 5 10 10 10s5-10 10-10' stroke='white' stroke-width='3' fill='none' opacity='0.1'/%3E%3C/svg%3E");
            opacity: 0.5; pointer-events: none;
        }

        .player-header {
            position: relative; z-index: 2;
            display: flex; flex-direction: column; align-items: center;
            margin-bottom: 20px;
        }
        
        .team-logo {
            width: 100px; height: 100px;
            background: white;
            border-radius: 50%;
            border: 4px solid white;
            object-fit: contain;
            padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .player-name {
            color: white; font-family: 'Titan One', cursive;
            font-size: 2rem; text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* --- CARD ROW --- */
        .cards-container {
            position: relative; z-index: 2;
            display: flex; flex-wrap: wrap; gap: 20px;
            justify-content: center;
        }

        .card-column {
            flex: 1 1 280px;
            max-width: 320px;
            display: flex; flex-direction: column; gap: 10px;
        }

        /* --- THE BINGO GRID --- */
        .bingo-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 3px solid white;
        }

        .card-title-bar {
            background: var(--gold); /* Default, overridden by team */
            color: #333;
            text-align: center; font-weight: 900;
            padding: 8px; font-size: 0.9rem;
            text-transform: uppercase;
        }

        .grid {
            display: grid; grid-template-columns: repeat(5, 1fr);
            gap: 2px; background: #ddd; border: 2px solid #ddd;
            aspect-ratio: 1/1;
        }

        .cell {
            background: white;
            display: flex; align-items: center; justify-content: center;
            text-align: center; font-size: 10px; padding: 3px;
            font-weight: 700; color: #333;
            line-height: 1.1; word-break: normal;
            user-select: none;
        }

        .is-me .cell { cursor: pointer; transition: 0.1s; }
        .is-me .cell:active { background: #eee; }

        .cell.free {
            font-size: 12px; font-weight: 900;
        }

        .cell.marked {
            background: var(--secondary) !important;
            color: white !important;
            position: relative;
        }

        /* --- REROLL BUTTON --- */
        .reroll-btn {
            background: rgba(255,255,255,0.2);
            border: 2px dashed rgba(255,255,255,0.5);
            color: white;
            padding: 8px;
            border-radius: 10px;
            font-weight: 700; font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .reroll-btn:hover:not(:disabled) {
            background: white; color: var(--primary);
        }
        .reroll-btn:disabled {
            opacity: 0.5; cursor: not-allowed; border-style: solid;
        }
        .reroll-count {
            background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;
        }

        /* --- WINNER ANIMATION --- */
        .player-wrapper.winner {
            animation: bounce 1s infinite;
            border-color: var(--gold);
            box-shadow: 0 0 40px var(--gold);
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .cell.winning-line {
            background: var(--gold) !important; color: black !important;
        }

        .hidden { display: none !important; }

        /* HEADER BAR */
        .header-controls {
            position: fixed; bottom: 10px; right: 10px; z-index: 500;
            background: white; padding: 10px; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex; gap: 10px; align-items: center;
        }

        /* Footballs */
        #celebration { position: fixed; inset: 0; pointer-events: none; z-index: 3000; overflow: hidden; }
        .football { position: absolute; font-size: 4rem; animation: spinFly 3s linear infinite; }
        @keyframes spinFly { 
            from { transform: translate(-100px, 100vh) rotate(0deg); } 
            to { transform: translate(120vw, -200px) rotate(720deg); } 
        }
    </style>
</head>
<body>

    <!-- LOBBY -->
    <div id="lobby">
        <div class="lobby-panel">
            <h1>NFL Beano</h1>
            <h3>Game Day Edition</h3>

            <div class="input-group">
                <label>Player Name</label>
                <input type="text" id="username" placeholder="NAME" maxlength="12">
            </div>

            <div class="input-group">
                <label>Pick Your Team</label>
                <select id="lobby-team-select">
                    <option value="None">Select Team...</option>
                    <!-- Teams JS -->
                </select>
            </div>

            <div style="display:flex; gap:10px;">
                <div class="input-group" style="flex:1">
                    <label>Cards</label>
                    <select id="lobby-count">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="input-group" style="flex:2">
                    <label>Room Code</label>
                    <input type="text" id="room-code-input" placeholder="NEW or CODE" style="text-transform: uppercase;">
                </div>
            </div>

            <div style="display:flex; gap:10px;">
                <button class="btn-host" onclick="startGame(true)">HOST</button>
                <button class="btn-join" onclick="startGame(false)">JOIN</button>
            </div>
        </div>
    </div>

    <!-- MAIN GAME UI -->
    <div id="game-ui" class="hidden">
        
        <!-- MY SIDE -->
        <div class="pane-my-hand">
            <div class="section-title">My Hand</div>
            <div id="my-area" style="width:100%; display:flex; justify-content:center;"></div>
        </div>

        <!-- FIELD SIDE -->
        <div class="pane-field">
            <div class="section-title">The Field</div>
            <div id="field-area" style="width:100%; display:flex; flex-direction:column; align-items:center; gap:20px;">
                <div style="color:rgba(255,255,255,0.5);">Waiting for players...</div>
            </div>
        </div>

        <!-- CONTROLS -->
        <div class="header-controls">
            <div>Room: <b id="room-display">----</b></div>
            <select id="ingame-team-select" onchange="changeMyTeam()" style="padding:5px; font-size:0.8rem; width:auto;">
                <!-- Teams JS -->
            </select>
            <button id="host-reset-btn" onclick="resetGame()" style="background:#ff4757; color:white; font-size:0.8rem; padding:5px 10px; width:auto; display:none;">RESET</button>
        </div>
    </div>

    <div id="celebration"></div>

<script>
    // =================================================================
    // 1. CONFIG
    // =================================================================
    const TEAMS = {
        "None": { p: "#333333", s: "#000000", logo: "nfl.svg" },
        "ARI": { p: "#97233F", s: "#000000", logo: "ari.svg" },
        "ATL": { p: "#A71930", s: "#000000", logo: "atl.svg" },
        "BAL": { p: "#241773", s: "#9E7C0C", logo: "bal.svg" },
        "BUF": { p: "#00338D", s: "#C60C30", logo: "buf.svg" },
        "CAR": { p: "#0085CA", s: "#000000", logo: "car.svg" },
        "CHI": { p: "#0B162A", s: "#C83803", logo: "chi.svg" },
        "CIN": { p: "#FB4F14", s: "#000000", logo: "cin.svg" },
        "CLE": { p: "#311D00", s: "#FF3C00", logo: "cle.svg" },
        "DAL": { p: "#003594", s: "#869397", logo: "dal.svg" },
        "DEN": { p: "#FB4F14", s: "#002244", logo: "den.svg" },
        "DET": { p: "#0076B6", s: "#B0B7BC", logo: "det.svg" },
        "GB":  { p: "#203731", s: "#FFB612", logo: "gb.svg" },
        "HOU": { p: "#03202F", s: "#A71930", logo: "hou.svg" },
        "IND": { p: "#002C5F", s: "#A2AAAD", logo: "ind.svg" },
        "JAX": { p: "#006778", s: "#9F792C", logo: "jax.svg" },
        "KC":  { p: "#E31837", s: "#FFB81C", logo: "kc.svg" },
        "LV":  { p: "#000000", s: "#A5ACAF", logo: "lv.svg" },
        "LAC": { p: "#0080C6", s: "#FFC20E", logo: "lac.svg" },
        "LAR": { p: "#003594", s: "#FFD100", logo: "lar.svg" },
        "MIA": { p: "#008E97", s: "#FC4C02", logo: "mia.svg" },
        "MIN": { p: "#4F2683", s: "#FFC62F", logo: "min.svg" },
        "NE":  { p: "#002244", s: "#C60C30", logo: "ne.svg" },
        "NO":  { p: "#D3BC8D", s: "#101820", logo: "no.svg" },
        "NYG": { p: "#0B2265", s: "#A71930", logo: "nyg.svg" },
        "NYJ": { p: "#125740", s: "#FFFFFF", logo: "nyj.svg" },
        "PHI": { p: "#004C54", s: "#A5ACAF", logo: "phi.svg" },
        "PIT": { p: "#FFB612", s: "#101820", logo: "pit.svg" },
        "SF":  { p: "#AA0000", s: "#B3995D", logo: "sf.svg" },
        "SEA": { p: "#002244", s: "#69BE28", logo: "sea.svg" },
        "TB":  { p: "#D50A0A", s: "#34302B", logo: "tb.svg" },
        "TEN": { p: "#0C2340", s: "#4B92DB", logo: "ten.svg" },
        "WAS": { p: "#5A1414", s: "#FFB612", logo: "was.svg" }
    };

    const EVENTS = [
        "Touchdown", "Field Goal", "First Down", "2-Pt Conv", "QB Scramble", "4th Down Try", 
        "Pass > 20 Yds", "Run > 10 Yds", "3rd & Long", "Screen > 10", "Play Action", "QB Sneak", 
        "Hail Mary", "Empty Backfield", "Shotgun", "Trick Play", "Fake Punt", "Sack", "TFL", 
        "Pass Defended", "Tipped Pass", "Thrown Away", "Interception", "Fumble", "Turnover", 
        "Defensive TD", "Goal Line Stand", "3-and-Out", "Red Zone Stop", "Blocked Kick", "Penalty Flag", 
        "Holding", "False Start", "Pass Int", "Delay of Game", "Int Grounding", 
        "Roughing Passer", "Face Mask", "Timeout", "2-Min Warning", "Challenge Flag", "Measurement", 
        "Overtime", "Injury", "Coach Yelling", "Mascot", "Blimp Shot", "Face Paint", "Shirtless Fan", 
        "Truck Ad", "Beer Ad", "Helmet Throw", "Cheerleader", "Celebrity", "Hurdle", "Juke", "One-Handed Catch"
    ];

    const WINS = [
        [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24], 
        [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24], 
        [0,6,12,18,24], [4,8,12,16,20]
    ];

    const BROKER = 'wss://broker.emqx.io:8084/mqtt';
    const TOPIC = 'nfl_beano_v4';
    let client, myId='u'+Math.random().toString(36).substr(2,5), myName="", myTeam="None", roomCode="", isHost=false;
    let gameState = { players: {} };

    // Init
    const ls = document.getElementById('lobby-team-select');
    const gs = document.getElementById('ingame-team-select');
    for(let t in TEAMS) {
        if(t!=="None") {
            ls.innerHTML += `<option value="${t}">${t}</option>`;
            gs.innerHTML += `<option value="${t}">${t}</option>`;
        }
    }

    // =================================================================
    // 2. LOGIC
    // =================================================================
    function startGame(host) {
        myName = document.getElementById('username').value.trim() || (host?"Host":"Guest");
        myTeam = ls.value;
        const count = parseInt(document.getElementById('lobby-count').value);
        
        isHost = host;
        roomCode = document.getElementById('room-code-input').value.trim().toUpperCase();
        if(host) roomCode = Math.random().toString(36).substr(2,4).toUpperCase();
        
        if(!roomCode) return alert("Need Code");

        if(host) {
            gameState.players[myId] = generatePlayer(myName, myTeam, count);
        }
        
        enterUI();
        connect();
    }

    function enterUI() {
        document.getElementById('lobby').classList.add('hidden');
        document.getElementById('game-ui').classList.remove('hidden');
        document.getElementById('room-display').innerText = roomCode;
        document.getElementById('ingame-team-select').value = myTeam;
        if(isHost) document.getElementById('host-reset-btn').style.display = 'block';
        render();
    }

    function generatePlayer(name, team, count) {
        let p = { name, team, cards: [] };
        for(let i=0; i<count; i++) {
            p.cards.push(createCardData());
        }
        return p;
    }

    function createCardData() {
        let deck = [...EVENTS].sort(()=>Math.random()-0.5).slice(0,24);
        deck.splice(12,0,"FREE");
        return { events: deck, marked: [12], winLine: [], rerolls: 2 };
    }

    function rerollCard(pId, cardIndex) {
        if(pId !== myId) return;
        let p = gameState.players[myId];
        let c = p.cards[cardIndex];
        if(c.rerolls > 0) {
            if(confirm("Reroll this card? You will lose current marks.")) {
                c.rerolls--;
                // Regenerate events
                let newData = createCardData();
                c.events = newData.events;
                c.marked = [12];
                c.winLine = [];
                
                // Update State
                render();
                send({ type: 'UPDATE', pData: p });
            }
        }
    }

    function changeMyTeam() {
        myTeam = document.getElementById('ingame-team-select').value;
        if(gameState.players[myId]) {
            gameState.players[myId].team = myTeam;
            render();
            send({ type: 'UPDATE_TEAM', team: myTeam });
        }
    }

    // =================================================================
    // 3. RENDER
    // =================================================================
    function render() {
        const myArea = document.getElementById('my-area');
        const fieldArea = document.getElementById('field-area');
        myArea.innerHTML = '';
        
        const others = Object.keys(gameState.players).filter(id => id !== myId);
        if(others.length > 0) fieldArea.innerHTML = '';

        if(gameState.players[myId]) renderPlayer(gameState.players[myId], true, myArea);
        others.forEach(pid => renderPlayer(gameState.players[pid], false, fieldArea));
    }

    function renderPlayer(p, isMe, container) {
        const colors = TEAMS[p.team] || TEAMS["None"];
        const wrap = document.createElement('div');
        wrap.className = 'player-wrapper';
        wrap.style.setProperty('--primary', colors.p);
        wrap.style.setProperty('--secondary', colors.s);

        if(p.cards.some(c => c.winLine.length>0)) wrap.classList.add('winner');

        // Header
        const header = document.createElement('div');
        header.className = 'player-header';
        
        // LOGO LOGIC
        const logoImg = document.createElement('img');
        logoImg.className = 'team-logo';
        // 1. Try Local File (This works if they have the folder)
        // 2. Fallback to remote if error
        const localPath = `logos/${p.team}.svg`; // Adjust extension if needed
        logoImg.src = localPath;
        logoImg.onerror = function() {
            // Fallback for demo purposes
            // Using a generic placeholder service or simple CDN approach
            // For strict local use, user ensures files exist.
            this.style.display = "none"; // Hide if broken and no fallback desired
            // OR use text fallback
        };
        if (p.team !== "None") header.appendChild(logoImg);

        const name = document.createElement('div');
        name.className = 'player-name';
        name.innerText = p.name;
        header.appendChild(name);
        wrap.appendChild(header);

        // Cards Container
        const cardsCont = document.createElement('div');
        cardsCont.className = 'cards-container';

        p.cards.forEach((c, cIdx) => {
            const col = document.createElement('div');
            col.className = 'card-column';

            const card = document.createElement('div');
            card.className = 'bingo-card';

            const title = document.createElement('div');
            title.className = 'card-title-bar';
            title.style.background = (c.winLine.length>0) ? '#fbbf24' : colors.s;
            title.style.color = (c.winLine.length>0) ? '#000' : '#fff';
            title.innerText = `Card ${cIdx+1}`;
            card.appendChild(title);

            const grid = document.createElement('div');
            grid.className = 'grid';

            c.events.forEach((evt, idx) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.innerText = evt;

                if(idx===12) {
                    cell.classList.add('free');
                    cell.style.color = colors.p;
                    cell.innerText = "FREE";
                }
                if(c.marked.includes(idx)) cell.classList.add('marked');
                if(c.winLine.includes(idx)) cell.classList.add('winning-line');

                if(isMe) {
                    cell.onclick = () => {
                        if(idx===12) return;
                        if(c.marked.includes(idx)) c.marked = c.marked.filter(x=>x!==idx);
                        else c.marked.push(idx);
                        
                        const w = checkWin(c.marked);
                        c.winLine = w || [];
                        if(w) celebrate();

                        render();
                        send({ type:'UPDATE', pData: p });
                    }
                }
                grid.appendChild(cell);
            });
            card.appendChild(grid);
            col.appendChild(card);

            // REROLL BUTTON (Only My Side)
            if(isMe) {
                const btn = document.createElement('button');
                btn.className = 'reroll-btn';
                btn.innerHTML = `<span>REROLL</span> <span class="reroll-count">${c.rerolls} left</span>`;
                if(c.rerolls <= 0) {
                    btn.disabled = true;
                    btn.innerHTML = `<span>LOCKED</span> <span class="reroll-count">0</span>`;
                }
                btn.onclick = () => rerollCard(myId, cIdx);
                col.appendChild(btn);
            }

            cardsCont.appendChild(col);
        });

        wrap.appendChild(cardsCont);
        container.appendChild(wrap);
    }

    function checkWin(m) {
        for(let l of WINS) if(l.every(i=>m.includes(i))) return l;
        return null;
    }

    // =================================================================
    // 4. NETWORK
    // =================================================================
    function connect() {
        client = mqtt.connect(BROKER);
        const t = `${TOPIC}/${roomCode}`;
        client.on('connect', ()=>{
            client.subscribe(t);
            if(isHost) setInterval(()=>send({type:'STATE', state:gameState}), 1000);
            else {
                // Join with card count pref
                const cnt = parseInt(document.getElementById('lobby-count').value);
                let iv = setInterval(()=>{
                    if(gameState.players[myId]) clearInterval(iv);
                    else send({type:'JOIN', name:myName, team:myTeam, count:cnt});
                }, 2000);
            }
        });

        client.on('message', (topic, msg)=>{
            const m = JSON.parse(msg.toString());
            if(m.sender === myId) return;

            if(isHost) {
                if(m.type==='JOIN' && !gameState.players[m.sender]) {
                    gameState.players[m.sender] = generatePlayer(m.name, m.team, m.count);
                    render();
                }
                if(m.type==='UPDATE') {
                    gameState.players[m.sender] = m.pData;
                    if(m.pData.cards.some(c=>c.winLine.length>0)) celebrate();
                    render();
                }
                if(m.type==='UPDATE_TEAM') {
                    if(gameState.players[m.sender]) {
                        gameState.players[m.sender].team = m.team;
                        render();
                    }
                }
            } else {
                if(m.type==='STATE') {
                    let local = gameState.players[myId];
                    gameState = m.state;
                    if(local) gameState.players[myId] = local; 
                    
                    if(Object.values(gameState.players).some(p=>p.cards.some(c=>c.winLine.length>0)) && !window.hasCel) {
                        celebrate(); window.hasCel=true;
                    }
                    render();
                }
            }
        });
    }

    function send(p) { p.sender=myId; client.publish(`${TOPIC}/${roomCode}`, JSON.stringify(p)); }

    function resetGame() {
        if(confirm("Reset all cards?")) {
            Object.keys(gameState.players).forEach(id=>{
                let p = gameState.players[id];
                gameState.players[id] = generatePlayer(p.name, p.team, p.cards.length);
            });
            window.hasCel=false;
            render();
        }
    }

    function celebrate() {
        const b = document.getElementById('celebration');
        for(let i=0; i<20; i++){
            let f = document.createElement('div'); f.className='football'; f.innerHTML='ðŸˆ';
            f.style.left='-100px'; f.style.top=Math.random()*80+'vh';
            f.style.animationDuration=(Math.random()*2+2)+'s';
            b.appendChild(f); setTimeout(()=>f.remove(), 4000);
        }
    }
</script>
</body>
</html>
